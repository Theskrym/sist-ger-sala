{% extends "admin/change_form.html" %}
{% load static %}

{% block extrahead %}
{{ block.super }}
<link rel="stylesheet" type="text/css" href="{% static 'admin/css/floor-plan.css' %}">
<script type="text/javascript" src="{% static 'admin/js/floor-plan.js' %}"></script>
{% endblock %}

{% block field_sets %}
    {% for fieldset in adminform %}
        {% if forloop.first %}
            <div class="floor-plan-container">
                <div class="file-input-container">
                    <label for="id_plan_image">Planta do Andar:</label>
                    <div class="file-upload">
                        <input type="file" 
                               id="id_plan_image" 
                               name="plan_image" 
                               accept="image/*"
                               {% if original.plan_image %}data-initial-file="{{ original.plan_image.url }}"{% endif %}>
                        <label for="id_plan_image" class="file-upload-button">
                            Escolher arquivo
                        </label>
                        <span class="file-upload-info">
                            {% if original.plan_image %}
                                {{ original.plan_image.name }}
                            {% else %}
                                Nenhum arquivo selecionado
                            {% endif %}
                        </span>
                        {% if original.plan_image %}
                            <span class="clear-file" onclick="clearFile()">Limpar</span>
                        {% endif %}
                    </div>
                </div>
                
                {% if original.plan_image %}
                    <div class="floor-plan-preview">
                        <h3>Preview:</h3>
                        <img src="{{ original.plan_image.url }}" 
                             alt="Floor Plan Preview"
                             class="floor-plan-image">
                    </div>
                {% endif %}
            </div>
        {% endif %}
        {% include "admin/includes/fieldset.html" %}
    {% endfor %}
{% endblock %}

{% block extrajs %}
{{ block.super }}
<script>
function clearFile() {
    const fileInput = document.getElementById('id_plan_image');
    const fileInfo = document.querySelector('.file-upload-info');
    const clearButton = document.querySelector('.clear-file');
    const preview = document.querySelector('.floor-plan-preview');
    
    fileInput.value = '';
    fileInfo.textContent = 'Nenhum arquivo selecionado';
    clearButton.style.display = 'none';
    if (preview) {
        preview.style.display = 'none';
    }
}

document.getElementById('id_plan_image').addEventListener('change', function(e) {
    const fileInfo = document.querySelector('.file-upload-info');
    const clearButton = document.querySelector('.clear-file');
    
    if (this.files && this.files[0]) {
        fileInfo.textContent = this.files[0].name;
        clearButton.style.display = 'inline-block';
    } else {
        fileInfo.textContent = 'Nenhum arquivo selecionado';
        clearButton.style.display = 'none';
    }
});
</script>
{% endblock %}