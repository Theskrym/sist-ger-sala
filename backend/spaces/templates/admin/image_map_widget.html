{% load static %}
<style>
    .image-map-widget {
        position: relative;
        display: inline-block;
    }
    .floor-plan-image {
        max-width: 100%;
        height: auto;
    }
    .location-pin {
        position: absolute;
        width: 20px;
        height: 20px;
        background-color: red;
        border-radius: 50%;
        transform: translate(-50%, -50%);
        cursor: pointer;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const containers = document.querySelectorAll('.image-map-widget');
    
    containers.forEach(container => {
        const img = container.querySelector('img');
        const xInput = container.querySelector('input[name$="_x"]');
        const yInput = container.querySelector('input[name$="_y"]');
        let pin = document.createElement('div');
        pin.className = 'location-pin';
        
        // Inicializa o pin na posição salva
        if (xInput.value && yInput.value) {
            pin.style.left = `${xInput.value}%`;
            pin.style.top = `${yInput.value}%`;
            container.appendChild(pin);
        }
        
        img.addEventListener('click', function(e) {
            const rect = img.getBoundingClientRect();
            const x = ((e.clientX - rect.left) / rect.width) * 100;
            const y = ((e.clientY - rect.top) / rect.height) * 100;
            
            xInput.value = x.toFixed(2);
            yInput.value = y.toFixed(2);
            
            pin.style.left = `${x}%`;
            pin.style.top = `${y}%`;
            
            if (!pin.parentNode) {
                container.appendChild(pin);
            }
        });
    });
});
</script>